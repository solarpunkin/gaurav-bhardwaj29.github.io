<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="../../weblog-style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      if (window.renderMathInElement) {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
          ]
        });
      }
    });
  </script>
  <title>Bypassing macOS code signing for ZIP-appended binaries</title>
</head>
<body>
  <div class="weblog-post">
    <h1>Bypassing macOS code signing for ZIP-appended binaries</h1>
    <div class="weblog-meta">
      <span class="weblog-date">2025-07-02</span>
      <span class="weblog-tags">
        <a href="../../tags/zip.html" class="weblog-tag">zip</a><a href="../../tags/claude.html" class="weblog-tag">claude</a><a href="../../tags/mac.html" class="weblog-tag">mac</a>
      </span>
    </div>
    <div class="weblog-content">
      <p>I wanted to append a zip data to the end of a binary executable in C to create a single executable server that reads its own zip tail on launch. </p>
<p>Doing this directly on my mac M2 via <code>cat repl site.zip &gt; repl.app</code>  and <code>chmod +x repl.app</code> returned a corrupted file which did not run. </p>
<p>Apparently macOS kills Mach-O binaries with appended data due to <a href="https://developer.apple.com/documentation/security/notarizing-macos-software-before-distribution">some code signing &amp; notarization rules</a>. </p>
<p>There is a possible <a href="https://stackoverflow.com/questions/1604673/how-do-i-embed-data-into-a-mac-os-x-mach-o-binary-files-text-section/1605237">workaround solution</a> that looks like it should work, instead I tried a simpler approach by creating a ‘polyglot file’ (a techie jargon for header files) which is part shell script and part binary. Claude helped me with this. Now doing <code>cat header.sh repl site.zip &gt; repl.app</code>  works with a little catch: I have to calculate (#bytes in repl - #bytes in site.zip) and update the header.sh dynamically when either of the two files change.</p>
<script>
function copyCode(button, preId) {
    const preElement = document.getElementById(preId);
    if (preElement) {
        const codeElement = preElement.querySelector('code');
        if (!codeElement) return;
        const codeText = codeElement.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
            const originalContent = button.innerHTML;
            button.innerHTML = 'Copied!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy code: ', err);
            const originalContent = button.innerHTML;
            button.innerHTML = 'Error!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        });
    }
}
</script>
    </div>
    <div class="weblog-footer">
      <a href="../../" class="weblog-back">← Back to all posts</a>
    </div>
  </div>
  
<script>
function copyCode(button, preId) {
    const preElement = document.getElementById(preId);
    if (preElement) {
        const codeElement = preElement.querySelector('code');
        if (!codeElement) return;
        const codeText = codeElement.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
            const originalContent = button.innerHTML;
            button.innerHTML = 'Copied!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy code: ', err);
            const originalContent = button.innerHTML;
            button.innerHTML = 'Error!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        });
    }
}
</script>
</body>
</html>