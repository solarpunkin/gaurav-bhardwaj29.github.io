<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="../../weblog-style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      if (window.renderMathInElement) {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
          ]
        });
      }
    });
  </script>
  <title>Hosting website as a subdomain on Google Cloud</title>
</head>
<body>
  <div class="weblog-post">
    <h1>Hosting website as a subdomain on Google Cloud</h1>
    <div class="weblog-meta">
      <span class="weblog-date">2025-06-24</span>
      <span class="weblog-tags">
        <a href="../../tags/cloud.html" class="weblog-tag">cloud</a>
      </span>
    </div>
    <div class="weblog-content">
      <p>I wanted to create a subdomain <a href="http://emailer.gaurv.me">emailer.gaurv.me</a> for hosting an automated cold email drafting service as a Flask website on Google Cloud Protocol. I get that this is a pretty lame name - I am also not good with naming things. That being said, first I had to log into Cloudflare Dashboard and add a new DNS record with type: CNAME and name: emailer and select the proxy status as <strong>DNS only.</strong></p>
<p>I figured that the best way to enable HTTPS for Flask app is just to go with DNS (orange cloud OFF). Once the records are set, create a new project (recommended) on Google Cloud and choose an Email API - I am using <a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com">Gmail API</a>. Create an OAuth 2.0 Client ID and add a redirect URI(s) which is your subdomain/callback URL - (<em>https://emailer.gaurv.me/oauth2callback</em> in this case). This creates a secret client JSON file which is visible for download only once.</p>
<p align="center">
  <img src="https://pub-91e1a485198740aabff1705e89606dc3.r2.dev/hosting-gcp/Screenshot%202025-06-24%20at%203.52.51%E2%80%AFAM.png" style="max-width: 100%; height: auto;" />
</p>

<p>Configure the scope of the API according to the project needs. Once the API service is set, open the left panel and choose Cloud Run → Services. This is where the website gets deployed. First of all, make sure you are under the same project in which the API is created. Deploy a container and create a service with a Docker image URL (dummify if not created yet). Choose any service name and select a region based on the needs of the app. My app was lightweight, so I went with two CPUs and 1 GiB. Allow authentication (<em>Require Authentication</em> for dev, <em>Allow unauthenticated</em> for prod) and add env variables as secrets under containers - this includes the client secret JSON file downloaded earlier, Flask app key and/or other secrets. The rest of the settings like scaling, ingress and instance/request-based are deployment specifics as they are app-dependent (Grok helped me through this). Finally, hit Create. </p>
<p align="center">
  <img src="https://pub-91e1a485198740aabff1705e89606dc3.r2.dev/hosting-gcp/Screenshot%202025-06-24%20at%204.13.15%E2%80%AFAM.png" style="max-width: 100%; height: auto;" />
</p>

<p>Now the service will be created (typically takes 10 - 15 seconds) with the service name. Select the service and it exposes a url - something like <em>https://service_name-xxxx.region.run.app</em></p>
<p>Then, I had to map my domain to my cloudflare account by verifying it on the <strong>domain mappings</strong> <a href="https://console.cloud.google.com/run/domains">page</a>. I selected the service, added the subdomain name (e.g. emailer.gaurv.me), and updated the DNS records from cloudflare. I then waited for some time before the DNS was verified and https started working.</p>
<p>One thing to note is that domain mapping is a preview feature as of writing this, so it has some limitations. These limitations are that it’s <strong>available in specific regions</strong> (<a href="https://cloud.google.com/run/docs/mapping-custom-domains#limitations">https://cloud.google.com/run/docs/mapping-custom-domains#limitations</a>). Since I wasn’t aware of this, I had to migrate my image to a new service in an acceptable region as a workaround.</p>
<p>Finally, the app went live, and I can now access it from my subdomain.</p>
<p align="center">
  <img src="https://pub-91e1a485198740aabff1705e89606dc3.r2.dev/hosting-gcp/Screenshot%202025-06-24%20at%204.46.49%E2%80%AFAM.png" style="max-width: 100%; height: auto;" />
</p>
<script>
function copyCode(button, preId) {
    const preElement = document.getElementById(preId);
    if (preElement) {
        const codeElement = preElement.querySelector('code');
        if (!codeElement) return;
        const codeText = codeElement.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
            const originalContent = button.innerHTML;
            button.innerHTML = 'Copied!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy code: ', err);
            const originalContent = button.innerHTML;
            button.innerHTML = 'Error!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        });
    }
}
</script>
    </div>
    <div class="weblog-footer">
      <a href="../../" class="weblog-back">← Back to all posts</a>
    </div>
  </div>
  
<script>
function copyCode(button, preId) {
    const preElement = document.getElementById(preId);
    if (preElement) {
        const codeElement = preElement.querySelector('code');
        if (!codeElement) return;
        const codeText = codeElement.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
            const originalContent = button.innerHTML;
            button.innerHTML = 'Copied!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy code: ', err);
            const originalContent = button.innerHTML;
            button.innerHTML = 'Error!';
            button.disabled = true;
            setTimeout(() => {
                button.innerHTML = originalContent;
                button.disabled = false;
            }, 2000);
        });
    }
}
</script>
</body>
</html>